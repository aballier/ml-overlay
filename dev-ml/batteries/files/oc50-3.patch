From f78adc4f5466481eb38e3efba1d0378b7c274084 Mon Sep 17 00:00:00 2001
From: Francois Berenger <unixjunkie@sdf.org>
Date: Mon, 29 Aug 2022 12:24:49 +0900
Subject: [PATCH 09/16] BatArray, BatList: repair some unit tests for OCaml < 5

---
 src/batArray.mlv | 3 ++-
 src/batList.mlv  | 3 ++-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/batArray.mlv b/src/batArray.mlv
index 2d9ff265..4847bc5e 100644
--- a/src/batArray.mlv
+++ b/src/batArray.mlv
@@ -934,7 +934,8 @@ let shuffle ?state a =
   let s = Random.State.make [|11|] in \
   let a = [|1;2;3;4;5;6;7;8;9|] in \
   shuffle ~state:s a; \
-  a = if Sys.ocaml_release.major < 5 then \
+  let ocaml_version = int_of_string (String.make 1 Sys.ocaml_version.[0]) in \
+  a = if ocaml_version < 5 then \
     [|7; 2; 9; 5; 3; 6; 4; 1; 8|] else \
     [|1; 7; 4; 9; 5; 2; 8; 6; 3|]
   let b = [||] in \
diff --git a/src/batList.mlv b/src/batList.mlv
index 929bc980..79f27d08 100644
--- a/src/batList.mlv
+++ b/src/batList.mlv
@@ -1546,7 +1546,8 @@ let shuffle ?state l =
 (*$T shuffle
   let s = Random.State.make [|11|] in \
   shuffle ~state:s [1;2;3;4;5;6;7;8;9] = \
-  if Sys.ocaml_release.major < 5 then \
+  let ocaml_version = int_of_string (String.make 1 Sys.ocaml_version.[0]) in \
+  if ocaml_version < 5 then \
     [7; 2; 9; 5; 3; 6; 4; 1; 8] else \
     [1; 7; 4; 9; 5; 2; 8; 6; 3]
   shuffle [] = []
-- 
2.38.1

